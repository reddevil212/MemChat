(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{6388:(e,t,s)=>{Promise.resolve().then(s.bind(s,1730))},1730:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>tq});var a=s(5155),r=s(2115),l=s(4565),i=s(7058),n=s(9904),d=s(333);let o=(0,n.Wp)({apiKey:"AIzaSyDuhwHO0R0QJ4CStv-fk2TgXCNDxKA5aiM",authDomain:"slidesavvy-6ab43.firebaseapp.com",databaseURL:"https://slidesavvy-6ab43-default-rtdb.firebaseio.com",projectId:"slidesavvy-6ab43",storageBucket:"slidesavvy-6ab43.appspot.com",messagingSenderId:"1033040450012",appId:"1:1033040450012:web:4d905cdf1840568b587f19",measurementId:"G-QQLEVL9RCW"}),c=(0,l.xI)(o),m=(0,i.aU)(o);(0,d.c7)(o);var u=s(1082);let x={isIncomingCall:!1,isOutgoingCall:!1,callerId:null,calleeId:null,localStream:null,remoteStream:null,callType:"audio",callAccepted:!1},h=(0,r.createContext)(void 0),f=e=>{let{currentUser:t,children:s}=e,[l,i]=(0,r.useState)(x),[n,d]=(0,r.useState)(null),[o,c]=(0,r.useState)(null),[m,f]=(0,r.useState)(null),g=(0,r.useRef)(null),p=(0,r.useRef)(null),j=(0,r.useRef)([]),y=e=>{j.current.push(e),e.addEventListener("ended",()=>{let t=j.current.indexOf(e);t>-1&&j.current.splice(t,1)})},w=e=>{e.getTracks().forEach(e=>{y(e)})},N=()=>{j.current.forEach(e=>e.stop()),j.current=[]},v=async()=>{N(),g.current=null,p.current=null,(await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})).getTracks().forEach(e=>e.stop());let e=[];for(let t=0;t<1e7;t++)e.push(t);e.length=0;let t=document.createElement("iframe");t.style.display="none",document.body.appendChild(t),setTimeout(()=>document.body.removeChild(t),100)},b=async(e,t)=>{if(!n)return;await v();let s=await navigator.mediaDevices.getUserMedia({video:"video"===t,audio:!0});w(s);let a=n.call(e,s,{metadata:{callType:t}}),r=n.connect(e);r.on("open",()=>{f(r)}),r.on("data",e=>{"endCall"===e&&S()}),a.on("stream",e=>{w(e),p.current=e,i(t=>({...t,remoteStream:e}))}),a.on("close",()=>{v(),i(x)}),i(a=>({...a,isOutgoingCall:!0,calleeId:e,localStream:s,callType:t,callAccepted:!1})),g.current=s,c(a)},C=async()=>{if(!o)return;await v();let e=await navigator.mediaDevices.getUserMedia({video:"video"===l.callType,audio:!0});w(e),o.answer(e);let t=n.connect(o.peer);t.on("open",()=>{f(t)}),t.on("data",e=>{"endCall"===e&&S()}),o.on("stream",e=>{w(e),p.current=e,i(t=>({...t,remoteStream:e}))}),o.on("close",()=>{v(),i(x)}),i(t=>({...t,localStream:e,callAccepted:!0,isIncomingCall:!1})),g.current=e},S=()=>{o&&o.close(),m&&m.send("endCall"),v(),i(x)};return(0,r.useEffect)(()=>{if(!t)return;let e=new u.Ay(t.uid);return e.on("open",e=>console.log("PeerJS connected with ID:",e)),e.on("call",e=>{i(t=>{var s;return{...t,isIncomingCall:!0,callerId:e.peer,callType:(null===(s=e.metadata)||void 0===s?void 0:s.callType)||"audio"}}),e.on("close",()=>{v(),i(x)}),c(e)}),e.on("connection",e=>{e.on("data",e=>{"endCall"===e&&S()}),f(e)}),e.on("disconnected",()=>{v(),i(x)}),e.on("error",()=>{v(),i(x)}),d(e),()=>{o&&o.close(),m&&m.close(),v(),e.destroy()}},[t]),(0,a.jsx)(h.Provider,{value:{callState:l,startCall:b,answerCall:C,rejectCall:()=>{o&&o.close(),m&&m.send("endCall"),v(),i(x)},endCall:S},children:s})},g=()=>{let e=(0,r.useContext)(h);if(!e)throw Error("useCall must be used within a CallProvider");return e},p=(0,n.Wp)({apiKey:"AIzaSyDuhwHO0R0QJ4CStv-fk2TgXCNDxKA5aiM",authDomain:"slidesavvy-6ab43.firebaseapp.com",databaseURL:"https://slidesavvy-6ab43-default-rtdb.firebaseio.com",projectId:"slidesavvy-6ab43",storageBucket:"slidesavvy-6ab43.appspot.com",messagingSenderId:"1033040450012",appId:"1:1033040450012:web:4d905cdf1840568b587f19",measurementId:"G-QQLEVL9RCW"}),j=(0,l.xI)(p),y=(0,i.aU)(p),w=(0,d.c7)(p),N={listenToChats:(e,t)=>{let s=(0,i.P)((0,i.rJ)(y,"chats"),(0,i._M)("participants","array-contains",e),(0,i.My)("lastMessageAt","desc"));return(0,i.aQ)(s,e=>{let s=[];e.forEach(e=>{s.push({id:e.id,...e.data()})}),t(s)})},listenToMessages:(e,t,s)=>{let a=(0,i.P)((0,i.rJ)(y,"chats",e,"messages"),(0,i.My)("timestamp","asc"));return(0,i.aQ)(a,e=>{let a=[];e.forEach(e=>{let t=e.data();a.push({id:e.id,...t}),s&&!1===t.read&&s(e.id)}),t(a)})},sendMessage:async(e,t)=>{let s=await (0,i.gS)((0,i.rJ)(y,"chats",e,"messages"),t);return await (0,i.mZ)((0,i.H9)(y,"chats",e),{lastMessage:{text:t.text,timestamp:t.timestamp},lastMessageAt:(0,i.O5)()}),s.id},sendReplyMessage:async(e,t,s)=>{try{let a={...t,replyToId:s.id,replyToText:s.text||"Media message"},r=await (0,i.gS)((0,i.rJ)(y,"chats",e,"messages"),a);return await (0,i.mZ)((0,i.H9)(y,"chats",e),{lastMessage:{text:t.text,timestamp:t.timestamp},lastMessageAt:(0,i.O5)()}),r.id}catch(e){throw console.error("Error sending reply message:",e),e}},uploadFile:async(e,t)=>{let s=e instanceof File?e.name:"blob_".concat(Date.now(),".file"),a=(0,d.KR)(w,"chat_files/".concat(t,"/").concat(Date.now(),"_").concat(s)),r=await (0,d.D)(a,e);return(0,d.qk)(r.ref)},createOrGetChat:async(e,t)=>{let s=(0,i.P)((0,i.rJ)(y,"chats"),(0,i._M)("participants","array-contains",e)),a=await (0,i.GG)(s),r=null;return(a.forEach(e=>{let s=e.data();s.participants.includes(t)&&(r={id:e.id,...s})}),r)?r:{id:(await (0,i.gS)((0,i.rJ)(y,"chats"),{participants:[e,t],lastMessage:null,lastMessageAt:(0,i.O5)(),unreadCount:0,createdAt:(0,i.O5)(),createdBy:e})).id,participants:[e,t],lastMessage:null,unreadCount:0,createdAt:new Date().toISOString(),createdBy:e}},editMessage:async(e,t,s)=>{try{let a=(0,i.H9)(y,"chats",e,"messages",t),r=await (0,i.x7)(a);if(!r.exists())throw Error("Message not found");await (0,i.mZ)(a,{text:s,isEdited:!0,editedAt:new Date().toISOString()});let l=(0,i.H9)(y,"chats",e),n=await (0,i.x7)(l);if(n.exists()){let e=n.data();e.lastMessage&&e.lastMessage.timestamp===r.data().timestamp&&await (0,i.mZ)(l,{"lastMessage.text":"".concat(s)})}return!0}catch(e){throw console.error("Error editing message:",e),e}},deleteMessage:async(e,t,s)=>{try{let a=(0,i.H9)(y,"chats",e,"messages",t),r=await (0,i.x7)(a);if(r.exists()){let e=r.data();if(e.fileUrl)try{let t=e.fileUrl,s=(0,d.KR)(w,t);await (0,d.XR)(s)}catch(e){console.warn("Could not delete file from storage:",e)}}if(await (0,i.kd)(a),s){let t=(0,i.rJ)(y,"chats",e,"messages"),s=(0,i.P)(t,(0,i.My)("timestamp","desc"),(0,i.AB)(1)),a=await (0,i.GG)(s);if(a.empty)await (0,i.mZ)((0,i.H9)(y,"chats",e),{lastMessage:null});else{let t=a.docs[0].data();await (0,i.mZ)((0,i.H9)(y,"chats",e),{lastMessage:{text:t.text,timestamp:t.timestamp}})}}let l=(0,i.P)((0,i.rJ)(y,"chats",e,"messages"),(0,i._M)("replyToId","==",t)),n=await (0,i.GG)(l);if(!n.empty){let t=n.docs.map(async t=>{await (0,i.mZ)((0,i.H9)(y,"chats",e,"messages",t.id),{replyToText:"This message was deleted"})});await Promise.all(t)}return!0}catch(e){throw console.error("Error deleting message:",e),e}},addReaction:async(e,t,s)=>{try{let a=(0,i.H9)(y,"chats",e,"messages",t),r=await (0,i.x7)(a);if(!r.exists())throw Error("Message not found");let l=(r.data().reactions||[]).find(e=>e.userId===s.userId&&e.emoji===s.emoji);return l?await (0,i.mZ)(a,{reactions:(0,i.C3)(l)}):await (0,i.mZ)(a,{reactions:(0,i.hq)(s)}),!0}catch(e){throw console.error("Error adding reaction:",e),e}},removeReaction:async(e,t,s)=>{try{let a=(0,i.H9)(y,"chats",e,"messages",t);if(!(await (0,i.x7)(a)).exists())throw Error("Message not found");return await (0,i.mZ)(a,{reactions:(0,i.C3)(s)}),!0}catch(e){throw console.error("Error removing reaction:",e),e}},toggleReaction:async(e,t,s,a)=>{try{let r=(0,i.H9)(y,"chats",e,"messages",t),l=await (0,i.x7)(r);if(!l.exists())throw Error("Message not found");let n=l.data().reactions||[],d=n.findIndex(e=>e.userId===s&&e.emoji===a);if(-1!==d){let e=n[d];await (0,i.mZ)(r,{reactions:(0,i.C3)(e)})}else{let e={userId:s,emoji:a,timestamp:new Date().toISOString()};await (0,i.mZ)(r,{reactions:(0,i.hq)(e)})}return!0}catch(e){throw console.error("Error toggling reaction:",e),e}},getMessageReactions:async(e,t)=>{try{let s=(0,i.H9)(y,"chats",e,"messages",t),a=await (0,i.x7)(s);if(!a.exists())throw Error("Message not found");return a.data().reactions||[]}catch(e){throw console.error("Error getting message reactions:",e),e}},markAllAsRead:async(e,t)=>{try{let s=(0,i.rJ)(y,"chats",e,"messages"),a=(0,i.P)(s,(0,i._M)("read","==",!1),(0,i._M)("senderId","!=",t)),r=await (0,i.GG)(a);if(r.empty)return!0;let l=r.docs.map(async t=>{await (0,i.mZ)((0,i.H9)(y,"chats",e,"messages",t.id),{read:!0,readAt:new Date().toISOString()})});return await Promise.all(l),await (0,i.mZ)((0,i.H9)(y,"chats",e),{unreadCount:0}),!0}catch(e){throw console.error("Error marking messages as read:",e),e}},forwardMessage:async(e,t,s,a)=>{try{let r=(0,i.H9)(y,"chats",t,"messages",e),l=await (0,i.x7)(r);if(!l.exists())throw Error("Message not found");let n=l.data(),d={senderId:a,text:n.text,timestamp:new Date().toISOString(),read:!1,isForwarded:!0,fileUrl:n.fileUrl,fileType:n.fileType,fileName:n.fileName,duration:n.duration};return await N.sendMessage(s,d)}catch(e){throw console.error("Error forwarding message:",e),e}},getUserPresence:async e=>{try{let t=(0,i.H9)(y,"users",e),s=await (0,i.x7)(t);if(!s.exists())throw Error("User not found");let a=s.data();return{status:a.status||"offline",lastSeen:a.lastSeen||null}}catch(e){throw console.error("Error getting user presence:",e),e}},updateTypingStatus:async(e,t,s)=>{try{let a=(0,i.H9)(y,"chats",e);return s?await (0,i.mZ)(a,{typingUsers:(0,i.hq)(t),["typingTimestamps.".concat(t)]:(0,i.O5)()}):await (0,i.mZ)(a,{typingUsers:(0,i.C3)(t),["typingTimestamps.".concat(t)]:null}),!0}catch(e){throw console.error("Error updating typing status:",e),e}},listenToTypingStatus:(e,t)=>{let s=(0,i.H9)(y,"chats",e);return(0,i.aQ)(s,e=>{e.exists()?t(e.data().typingUsers||[]):t([])})},toggleStarredMessage:async(e,t,s)=>{try{let a=(0,i.H9)(y,"chats",e,"messages",t),r=await (0,i.x7)(a);if(!r.exists())throw Error("Message not found");if((r.data().starredBy||[]).includes(s))await (0,i.mZ)(a,{starredBy:(0,i.C3)(s)});else{await (0,i.mZ)(a,{starredBy:(0,i.hq)(s)});let r=(0,i.H9)(y,"users",s,"starredMessages",t);await (0,i.mZ)(r,{messageId:t,chatId:e,starredAt:(0,i.O5)()}).catch(async()=>{await (0,i.gS)((0,i.rJ)(y,"users",s,"starredMessages"),{messageId:t,chatId:e,starredAt:(0,i.O5)()})})}return!0}catch(e){throw console.error("Error toggling starred message:",e),e}},getStarredMessages:async e=>{try{let t=(0,i.rJ)(y,"users",e,"starredMessages"),s=(0,i.P)(t,(0,i.My)("starredAt","desc")),a=await (0,i.GG)(s),r=[],l=a.docs.map(async e=>{let t=e.data(),s=e(y,"chats",t.chatId,"messages",t.messageId),a=await (0,i.x7)(s);return a.exists()?{messageId:t.messageId,chatId:t.chatId,message:{id:a.id,...a.data()}}:{messageId:t.messageId,chatId:t.chatId}}),n=await Promise.all(l);return r.push(...n),r}catch(e){throw console.error("Error getting starred messages:",e),e}},getMessageById:async(e,t)=>{try{let s=(0,i.H9)(y,"chats",e,"messages",t),a=await (0,i.x7)(s);if(!a.exists())throw Error("Message not found");return{id:a.id,...a.data()}}catch(e){throw console.error("Error getting message by ID:",e),e}},searchMessages:async(e,t)=>{try{let s=(0,i.rJ)(y,"chats",e,"messages"),a=(0,i.P)(s,(0,i.My)("timestamp","desc")),r=await (0,i.GG)(a),l=[];return r.forEach(e=>{let s={id:e.id,...e.data()};s.text&&s.text.toLowerCase().includes(t.toLowerCase())&&l.push(s)}),l}catch(e){throw console.error("Error searching messages:",e),e}},pinMessage:async(e,t,s)=>{try{let a=(0,i.H9)(y,"chats",e),r=await (0,i.x7)(a);if(!r.exists())throw Error("Chat not found");r.data(),await (0,i.mZ)(a,{pinnedMessage:{messageId:t,pinnedAt:(0,i.O5)(),pinnedBy:s}});let l=(0,i.H9)(y,"chats",e,"messages",t);return await (0,i.mZ)(l,{isPinned:!0,pinnedBy:s,pinnedAt:new Date().toISOString()}),!0}catch(e){throw console.error("Error pinning message:",e),e}},unpinMessage:async(e,t)=>{try{let s=(0,i.H9)(y,"chats",e);await (0,i.mZ)(s,{pinnedMessage:null});let a=(0,i.H9)(y,"chats",e,"messages",t);return await (0,i.mZ)(a,{isPinned:!1,pinnedBy:null,pinnedAt:null}),!0}catch(e){throw console.error("Error unpinning message:",e),e}},getChatStatistics:async e=>{try{let t=(0,i.rJ)(y,"chats",e,"messages"),s=await (0,i.GG)(t),a=0,r=0,l=0,n=0,d={};return s.forEach(e=>{let t=e.data();a++,t.fileUrl?r++:l++,t.replyToId&&n++,t.senderId&&(d[t.senderId]=(d[t.senderId]||0)+1)}),{totalMessages:a,mediaMessages:r,textMessages:l,replyMessages:n,messagesBySender:d}}catch(e){throw console.error("Error getting chat statistics:",e),e}}};var v=s(3463),b=s(9795);function C(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,b.QP)((0,v.$)(t))}let S=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:C("rounded-xl border bg-card text-card-foreground shadow",s),...r})});S.displayName="Card",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:C("flex flex-col space-y-1.5 p-6",s),...r})}).displayName="CardHeader";let k=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:C("font-semibold leading-none tracking-tight",s),...r})});k.displayName="CardTitle";let M=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:C("text-sm text-muted-foreground",s),...r})});M.displayName="CardDescription";let R=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:C("p-6 pt-0",s),...r})});R.displayName="CardContent";let E=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:C("flex items-center p-6 pt-0",s),...r})});E.displayName="CardFooter";var I=s(4920);let T=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(I.bL,{ref:t,className:C("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...r})});T.displayName=I.bL.displayName;let A=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(I._V,{ref:t,className:C("aspect-square h-full w-full",s),...r})});A.displayName=I._V.displayName;let U=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(I.H4,{ref:t,className:C("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...r})});U.displayName=I.H4.displayName;var D=s(2317),z=s(1027);let L=(0,z.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),P=r.forwardRef((e,t)=>{let{className:s,variant:r,size:l,asChild:i=!1,...n}=e,d=i?D.DX:"button";return(0,a.jsx)(d,{className:C(L({variant:r,size:l,className:s})),ref:t,...n})});P.displayName="Button";let O=r.forwardRef((e,t)=>{let{className:s,type:r,...l}=e;return(0,a.jsx)("input",{type:r,className:C("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...l})});O.displayName="Input";var F=s(1466),H=s(5236),_=s(853),Z=s(3348),G=s(2823),J=s(3929),B=s(8236),V=s(3518),Y=s(6967),Q=s(767);let W=e=>e.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2),q=e=>{let t=new Date(e),s=new Date,a=new Date(s.getFullYear(),s.getMonth(),s.getDate()),r=new Date(a),l=new Date(a);r.setDate(a.getDate()+1),l.setDate(a.getDate()-1);let i=t>=a&&t<r,n=t>=r&&t<new Date(r.getFullYear(),r.getMonth(),r.getDate()+1),d=t>=l&&t<a,o={hour:"2-digit",minute:"2-digit"};return i?t.toLocaleTimeString([],o):d?"Yesterday ".concat(t.toLocaleTimeString([],o)):n?"Tomorrow ".concat(t.toLocaleTimeString([],o)):(o.month="short",o.day="numeric",t.toLocaleDateString([],o)+" "+t.toLocaleTimeString([],o))},K=e=>{let{users:t,onStartChat:s}=e;return(0,a.jsxs)("div",{className:"py-2",children:[(0,a.jsx)("h3",{className:"px-3 py-1 text-xs font-medium bg text-gray-400",children:"USERS"}),t.length>0?t.map(e=>(0,a.jsxs)("div",{className:"px-3 py-2 flex items-center space-x-3 hover:bg-[#2a2a2a] cursor-pointer",onClick:()=>s(e.uid),children:[(0,a.jsxs)(T,{className:"h-10 w-10",children:[(0,a.jsx)(A,{src:e.photoURL||void 0}),(0,a.jsx)(U,{className:"bg-gray-600 text-white",children:W(e.displayName)})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h4",{className:"font-medium text-sm text-white truncate",children:e.displayName}),(0,a.jsx)("p",{className:"text-xs text-gray-400 truncate",children:e.status})]})]},e.uid)):(0,a.jsx)("p",{className:"px-3 py-2 text-sm text-gray-400",children:"No users found"})]})},X=e=>{let{chats:t,users:s,currentUser:r,selectedChat:l,onChatSelect:i}=e;return(0,a.jsxs)("div",{className:" space-y-1 ",children:[t.map(e=>{let t=e.participants.find(e=>e!==(null==r?void 0:r.uid)),n=s.find(e=>e.uid===t);return(0,a.jsxs)("div",{className:"px-3 py-2 flex items-center space-x-3 cursor-pointer\n              ".concat((null==l?void 0:l.id)===e.id?"bg-[#2a2a2a]":"hover:bg-[#2a2a2a]"),onClick:()=>i(e),children:[(0,a.jsxs)(T,{className:"h-10 w-10 flex-shrink-0",children:[(0,a.jsx)(A,{src:(null==n?void 0:n.photoURL)||void 0}),(0,a.jsx)(U,{className:"bg-blue-500 text-white",children:n?W(n.displayName):"?"})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h4",{className:"font-medium text-sm text-white truncate",children:(null==n?void 0:n.displayName)||"Unknown User"}),e.lastMessage&&(0,a.jsx)("span",{className:"text-[10px] text-gray-400",children:q(e.lastMessage.timestamp)})]}),(0,a.jsx)("p",{className:"text-xs text-gray-400 truncate",children:e.lastMessage?e.lastMessage.text:"No messages yet"})]})]},e.id)}),0===t.length&&(0,a.jsxs)("div",{className:"px-3 py-6 text-center",children:[(0,a.jsx)("p",{className:"text-sm text-gray-400",children:"No conversations yet"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Search for users to start chatting"})]})]})},$=e=>{let{users:t,currentUser:s,onStartChat:r}=e,l=t.filter(e=>e.uid!==(null==s?void 0:s.uid)).sort((e,t)=>e.displayName.localeCompare(t.displayName));return(0,a.jsxs)("div",{className:"py-2",children:[(0,a.jsx)("h3",{className:"px-3 py-1 text-xs font-medium text-gray-400",children:"CONTACTS"}),l.length>0?l.map(e=>(0,a.jsxs)("div",{className:"px-3 py-2 flex items-center space-x-3 hover:bg-[#2a2a2a] cursor-pointer",onClick:()=>r(e.uid),children:[(0,a.jsxs)(T,{className:"h-10 w-10",children:[(0,a.jsx)(A,{src:e.photoURL||void 0}),(0,a.jsx)(U,{className:"bg-gray-600 text-white",children:W(e.displayName)})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h4",{className:"font-medium text-sm text-white truncate",children:e.displayName}),(0,a.jsx)("p",{className:"text-xs text-gray-400 truncate",children:e.status||"Offline"})]})]},e.uid)):(0,a.jsx)("p",{className:"px-3 py-2 text-sm text-gray-400",children:"No contacts found"})]})},ee=e=>{let{currentUser:t,onSignOut:s}=e;return(0,a.jsxs)("div",{className:"p-3 space-y-4",children:[(0,a.jsx)("h3",{className:"px-3 py-1 text-xs font-medium text-gray-400",children:"SETTINGS"}),(0,a.jsxs)("div",{className:"px-3 py-2 bg-[#2a2a2a] rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,a.jsxs)(T,{className:"h-14 w-14",children:[(0,a.jsx)(A,{src:(null==t?void 0:t.photoURL)||void 0}),(0,a.jsx)(U,{className:"bg-gray-600 text-white text-lg",children:(null==t?void 0:t.displayName)?W(t.displayName):"U"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-white",children:(null==t?void 0:t.displayName)||"User"}),(0,a.jsx)("p",{className:"text-xs text-gray-400",children:(null==t?void 0:t.email)||""})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(P,{variant:"outline",className:"w-full justify-start text-gray-300 border-gray-700 hover:bg-[#3a3a3a]",children:[(0,a.jsx)(F.A,{className:"h-4 w-4 mr-2"}),"Edit Profile"]}),(0,a.jsxs)(P,{variant:"outline",className:"w-full justify-start text-gray-300 border-gray-700 hover:bg-[#3a3a3a]",onClick:s,children:[(0,a.jsx)(H.A,{className:"h-4 w-4 mr-2"}),"Sign Out"]})]})]}),(0,a.jsxs)("div",{className:"px-3 py-2 bg-[#2a2a2a] rounded-lg",children:[(0,a.jsx)("h5",{className:"text-sm font-medium text-white mb-2",children:"Appearance"}),(0,a.jsx)("div",{className:"space-y-2",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-300",children:"Dark Mode"}),(0,a.jsx)("span",{className:"text-xs text-gray-400",children:"Enabled"})]})})]})]})},et=e=>{let{isOpen:t,onClose:s,currentUser:l,users:i,chats:n,selectedChat:d,searchQuery:o,onSearchChange:c,onSignOut:m,onChatSelect:u,onStartChat:x}=e,[h,f]=(0,r.useState)("chats"),[g,p]=(0,r.useState)(!0);return(0,a.jsxs)("div",{className:"flex h-full ".concat(t?"block":"hidden md:flex"),children:[(0,a.jsxs)("div",{className:"flex flex-col bg-black border-r border-gray-800 transition-all duration-300",style:{width:g?"240px":"56px"},children:[(0,a.jsxs)("div",{className:"flex-1 flex flex-col items-center pt-4 space-y-5",children:[(0,a.jsx)(P,{variant:"ghost",size:"icon",className:"h-10 w-10 rounded-full ".concat("chats"===h?"bg-gray-700 text-white":"text-gray-400 hover:text-white hover:bg-[#2a2a2a]"),onClick:()=>f("chats"),title:"Chats",children:(0,a.jsx)(Z.A,{className:"h-5 w-5"})}),(0,a.jsx)(P,{variant:"ghost",size:"icon",className:"h-10 w-10 rounded-full ".concat("contacts"===h?"bg-gray-700 text-white":"text-gray-400 hover:text-white hover:bg-[#2a2a2a]"),onClick:()=>f("contacts"),title:"Contacts",children:(0,a.jsx)(G.A,{className:"h-5 w-5"})}),(0,a.jsx)(P,{variant:"ghost",size:"icon",className:"h-10 w-10 rounded-full ".concat("search"===h?"bg-gray-700 text-white":"text-gray-400 hover:text-white hover:bg-[#2a2a2a]"),onClick:()=>f("search"),title:"Search Users",children:(0,a.jsx)(J.A,{className:"h-5 w-5"})})]}),(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-5 pb-5",children:[(0,a.jsx)(P,{variant:"ghost",size:"icon",className:"h-10 w-10 rounded-full ".concat("settings"===h?"bg-gray-700 text-white":"text-gray-400 hover:text-white hover:bg-[#2a2a2a]"),onClick:()=>f("settings"),title:"Settings",children:(0,a.jsx)(B.A,{className:"h-5 w-5"})}),(0,a.jsx)(P,{variant:"ghost",size:"icon",className:"h-10 w-10 rounded-full text-gray-400 hover:text-white hover:bg-[#2a2a2a]",onClick:()=>p(!g),title:g?"Collapse sidebar":"Expand sidebar",children:g?(0,a.jsx)(V.A,{className:"h-5 w-5"}):(0,a.jsx)(Y.A,{className:"h-5 w-5"})})]})]}),g&&(0,a.jsx)("div",{className:"flex-1 flex flex-col h-full bg-[#1e1d1d] border-r border-gray-800 transition-all duration-300",children:(()=>{switch(h){case"chats":return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"p-3 bg-[#000000] border-b border-gray-800 flex items-center justify-between",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)(T,{className:"h-8 w-8",children:[(0,a.jsx)(A,{src:(null==l?void 0:l.photoURL)||void 0}),(0,a.jsx)(U,{className:"bg-gray-600 text-white text-sm",children:(null==l?void 0:l.displayName)?W(l.displayName):"U"})]}),(0,a.jsx)("div",{children:(0,a.jsx)("h2",{className:"text-sm font-semibold text-white truncate max-w-[150px]",children:null==l?void 0:l.displayName})})]})}),(0,a.jsx)("div",{className:"flex-1 bg-[#000000] overflow-y-auto",children:(0,a.jsx)(X,{chats:n,users:i,currentUser:l,selectedChat:d,onChatSelect:u})})]});case"contacts":return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"p-3 bg-[#000000] border-b border-gray-800",children:(0,a.jsx)("h2",{className:"text-sm font-semibold text-white",children:"Contacts"})}),(0,a.jsx)("div",{className:"flex-1 bg-[#000000] overflow-y-auto",children:(0,a.jsx)($,{users:i,currentUser:l,onStartChat:x})})]});case"search":return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"p-3 bg-[#000000] border-b border-gray-800",children:(0,a.jsx)("h2",{className:"text-sm font-semibold text-white",children:"Search Users"})}),(0,a.jsx)("div",{className:"p-2 border-b border-gray-800",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(_.A,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,a.jsx)(O,{placeholder:"Search users",className:"pl-8 h-9 text-sm bg-[#000000] border-gray-700 text-white focus:ring-1 focus:ring-gray-600",value:o,onChange:e=>c(e.target.value)})]})}),(0,a.jsx)("div",{className:"flex-1 bg-[#000000] overflow-y-auto",children:(0,a.jsx)(K,{users:i,onStartChat:x})})]});case"settings":return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"p-3 bg-[#000000] border-b border-gray-800",children:(0,a.jsx)("h2",{className:"text-sm font-semibold text-white",children:"Settings"})}),(0,a.jsx)("div",{className:"flex-1 bg-[#000000] overflow-y-auto",children:(0,a.jsx)(ee,{currentUser:l,onSignOut:m})})]})}})()}),(0,a.jsx)("div",{className:"absolute top-2 right-2 md:hidden",children:(0,a.jsx)(P,{variant:"ghost",size:"sm",onClick:s,className:"text-gray-400 hover:bg-[#2a2a2a]",children:(0,a.jsx)(Q.A,{className:"h-5 w-5"})})})]})};var es=s(6710),ea=s(1091),er=s(6122),el=s(3831),ei=s(7820),en=s(6293),ed=s(814),eo=s(2098);let ec=eo.bL,em=eo.l9,eu=r.forwardRef((e,t)=>{let{className:s,align:r="center",sideOffset:l=4,...i}=e;return(0,a.jsx)(eo.UC,{ref:t,align:r,sideOffset:l,className:C("z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...i})});function ex(e){let{className:t,...s}=e;return(0,a.jsx)("div",{className:C("animate-pulse rounded-md bg-primary/10",t),...s})}eu.displayName=eo.UC.displayName;var eh=s(7756);let ef=eh.Kq,eg=eh.bL,ep=eh.l9,ej=r.forwardRef((e,t)=>{let{className:s,sideOffset:r=4,...l}=e;return(0,a.jsx)(eh.ZL,{children:(0,a.jsx)(eh.UC,{ref:t,sideOffset:r,className:C("z-50 overflow-hidden rounded-md bg-primary dark:bg-black px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...l})})});ej.displayName=eh.UC.displayName;let ey=e=>{let t;if(!e)return"Unknown";if(e.seconds)t=new Date(1e3*e.seconds);else{if("string"!=typeof e)return"Unknown";t=new Date(e)}if(isNaN(t.getTime()))return"Unknown";let s=new Date,a=new Date(s.getFullYear(),s.getMonth(),s.getDate()),r=new Date(a);return(r.setDate(a.getDate()-1),t.getFullYear()===a.getFullYear()&&t.getMonth()===a.getMonth()&&t.getDate()===a.getDate())?"Today at ".concat(t.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"})):t.getFullYear()===r.getFullYear()&&t.getMonth()===r.getMonth()&&t.getDate()===r.getDate()?"Yesterday at ".concat(t.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"})):"Last seen on ".concat(t.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})," at ").concat(t.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"}))},ew=e=>{let{user:t,onOpenSidebar:s,showMenuButton:l=!1,onCall:n}=e,{startCall:d}=g(),[o,c]=(0,r.useState)(t),[u,x]=(0,r.useState)(!0),[h,f]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=(0,i.H9)(m,"users",t.uid),s=(0,i.aQ)(e,e=>{e.exists()&&(c(e.data()),x(!1))});return()=>s()},[t.uid]),(0,r.useEffect)(()=>{let e=setTimeout(()=>{f(!0)},2e3);return()=>clearTimeout(e)},[]);let p=e=>{if(!h){ed.oR.error("Call system is still initializing. Please try again in a moment.");return}try{n?n(e):d?d(o.uid,e):ed.oR.error("Call functionality is not available")}catch(e){console.error("Call error:",e),ed.oR.error("Failed to start call: ".concat(e instanceof Error?e.message:String(e)))}};return(0,a.jsxs)("div",{className:"p-3 bg-[#000000] border-b border-gray-800 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[l&&(0,a.jsx)(P,{variant:"ghost",size:"sm",className:"md:hidden",onClick:s,children:(0,a.jsx)(es.A,{className:"h-4 w-4 text-gray-400"})}),(0,a.jsxs)(ec,{children:[(0,a.jsx)(em,{children:(0,a.jsxs)(T,{className:"h-8 w-8",children:[(0,a.jsx)(A,{src:o.photoURL||void 0}),(0,a.jsx)(U,{className:"bg-green-500 text-white text-sm",children:o.displayName.charAt(0).toUpperCase()})]})}),(0,a.jsx)(eu,{className:"w-80 p-4 dark:bg-black dark:text-white bg-white text-black rounded-lg shadow-lg",children:u?(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsx)(ex,{className:"h-14 w-14 rounded-full"}),(0,a.jsxs)("div",{className:"space-y-2 w-full",children:[(0,a.jsx)(ex,{className:"h-4 w-full"}),(0,a.jsx)(ex,{className:"h-4 w-3/4"})]})]}):(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsxs)(T,{className:"h-14 w-14",children:[(0,a.jsx)(A,{src:o.photoURL||void 0}),(0,a.jsx)(U,{children:o.displayName.charAt(0).toUpperCase()})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("h4",{className:"text-sm font-semibold",children:o.displayName}),(0,a.jsxs)("div",{className:"flex items-center pt-2",children:[(0,a.jsx)(ea.A,{className:"mr-2 h-4 w-4 opacity-70"}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:o.email})]}),(0,a.jsxs)("div",{className:"flex items-center pt-2",children:[(0,a.jsx)(er.A,{className:"mr-2 h-4 w-4 opacity-70"}),(0,a.jsx)("span",{className:"text-xs text-gray-400",children:ey(o.lastSeen)})]})]})]})})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h2",{className:"font-medium text-sm text-white truncate",children:o.displayName}),(0,a.jsx)("p",{className:"text-xs text-gray-400",children:"online"===o.status?"online":"Last seen: ".concat(ey(o.lastSeen))})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(ef,{children:(0,a.jsxs)(eg,{children:[(0,a.jsx)(ep,{asChild:!0,children:(0,a.jsx)(P,{variant:"ghost",size:"sm",onClick:()=>p("audio"),className:"text-gray-400 hover:text-white hover:bg-gray-700",children:(0,a.jsx)(el.A,{className:"h-4 w-4"})})}),(0,a.jsx)(ej,{children:(0,a.jsx)("p",{className:"dark:bg-black text-white",children:"Start audio call"})})]})}),(0,a.jsx)(ef,{children:(0,a.jsxs)(eg,{children:[(0,a.jsx)(ep,{asChild:!0,children:(0,a.jsx)(P,{variant:"ghost",size:"sm",onClick:()=>p("video"),className:"text-gray-400 hover:text-white hover:bg-gray-700",children:(0,a.jsx)(ei.A,{className:"h-4 w-4"})})}),(0,a.jsx)(ej,{children:(0,a.jsx)("p",{className:"dark:bg-black text-white",children:"Start video call"})})]})}),(0,a.jsx)(ef,{children:(0,a.jsxs)(eg,{children:[(0,a.jsx)(ep,{asChild:!0,children:(0,a.jsx)(P,{variant:"ghost",size:"sm",onClick:()=>(0,ed.oR)("Coming soon!"),className:"text-gray-400 hover:text-white hover:bg-gray-700",children:(0,a.jsx)(en.A,{className:"h-4 w-4 text-gray-400"})})}),(0,a.jsx)(ej,{children:(0,a.jsx)("p",{className:"dark:bg-black text-white",children:"More"})})]})})]})]})};var eN=s(8283),ev=s(5686),eb=s(5843),eC=s(5015),eS=s(4216),ek=s(6164);let eM=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("textarea",{className:C("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...r})});eM.displayName="Textarea";var eR=s(532);let eE=eR.bL,eI=eR.l9;eR.Mz;let eT=r.forwardRef((e,t)=>{let{className:s,align:r="center",sideOffset:l=4,...i}=e;return(0,a.jsx)(eR.ZL,{children:(0,a.jsx)(eR.UC,{ref:t,align:r,sideOffset:l,className:C("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...i})})});eT.displayName=eR.UC.displayName;var eA=s(6838);let eU=r.forwardRef((e,t)=>{let{className:s,value:r,...l}=e;return(0,a.jsx)(eA.bL,{ref:t,className:C("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",s),...l,children:(0,a.jsx)(eA.C1,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(r||0),"%)")}})})});eU.displayName=eA.bL.displayName;var eD=s(3301);let ez=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsxs)(eD.bL,{ref:t,className:C("relative flex w-full touch-none select-none items-center",s),...r,children:[(0,a.jsx)(eD.CC,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20",children:(0,a.jsx)(eD.Q6,{className:"absolute h-full bg-primary"})}),(0,a.jsx)(eD.zi,{className:"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"})]})});ez.displayName=eD.bL.displayName;var eL=s(2725),eP=s(9191),eO=s(650),eF=s(5220);function eH(e){let{src:t,className:s,initialDuration:l}=e,[i,n]=(0,r.useState)(!1),[d,o]=(0,r.useState)(0),[c,m]=(0,r.useState)(l||0),[u,x]=(0,r.useState)(1),[h,f]=(0,r.useState)(!1),g=(0,r.useRef)(null);(0,r.useEffect)(()=>{let e=g.current;if(!e)return;let t=()=>{l||m(e.duration)},s=()=>{o(e.currentTime)},a=()=>{n(!1),e.currentTime=0,o(0)};return e.addEventListener("loadeddata",t),e.addEventListener("timeupdate",s),e.addEventListener("ended",a),()=>{e.removeEventListener("loadeddata",t),e.removeEventListener("timeupdate",s),e.removeEventListener("ended",a)}},[l]),(0,r.useEffect)(()=>{l&&m(l)},[l]);let p=e=>{if(isNaN(e))return"00:00";let t=Math.floor(e/60),s=Math.floor(e%60);return"".concat(t.toString().padStart(2,"0"),":").concat(s.toString().padStart(2,"0"))};return(0,a.jsxs)("div",{className:C("flex flex-col space-y-2",s),children:[(0,a.jsx)("audio",{ref:g,src:t,preload:"metadata"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(P,{variant:"ghost",size:"sm",className:"h-8 w-8 rounded-full p-0",onClick:()=>{let e=g.current;e&&(i?(e.pause(),n(!1)):(e.play(),n(!0)))},children:i?(0,a.jsx)(eL.A,{className:"h-4 w-4"}):(0,a.jsx)(eP.A,{className:"h-4 w-4"})}),(0,a.jsx)(ez,{value:[d],max:c||100,step:.1,onValueChange:e=>{let t=g.current;t&&(t.currentTime=e[0],o(e[0]))},className:"w-full"}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground w-16 text-right",children:[p(d),"/",p(c)]}),(0,a.jsx)(P,{variant:"ghost",size:"sm",className:"h-8 w-8 rounded-full p-0",onClick:()=>{let e=g.current;e&&(h?(e.volume=u,f(!1)):(e.volume=0,f(!0)))},children:h?(0,a.jsx)(eO.A,{className:"h-4 w-4"}):(0,a.jsx)(eF.A,{className:"h-4 w-4"})})]})]})}var e_=s(5683),eZ=s(778);let eG=e=>{let{onEmojiSelect:t}=e;return(0,a.jsx)("div",{className:"grid grid-cols-5 gap-2 p-2",children:["\uD83D\uDE0A","\uD83D\uDE02","❤️","\uD83D\uDC4D","\uD83D\uDE4C","\uD83C\uDF89","\uD83D\uDD25","\uD83D\uDC4F","\uD83E\uDD14","\uD83D\uDE0D"].map(e=>(0,a.jsx)("button",{className:"h-8 w-8 p-0",onClick:()=>t(e),children:e},e))})},eJ=e=>{let{message:t,isUploading:s,replyingTo:l=null,editingMessage:i=null,onMessageChange:n,onSendMessage:d,onFileSelect:o,onVoiceMessageSend:c,onCancelReply:m=()=>{},onCancelEdit:u=()=>{}}=e,[x,h]=(0,r.useState)(0),[f,g]=(0,r.useState)(!1),[p,j]=(0,r.useState)(null),[y,w]=(0,r.useState)(0),N=(0,r.useRef)(null),v=(0,r.useRef)([]),b=(0,r.useRef)(null),C=(0,r.useRef)(null),k=(0,r.useRef)(null);(0,r.useEffect)(()=>{k.current&&(k.current.focus(),M())},[t,l,i]),s&&x<100?setTimeout(()=>{h(e=>Math.min(e+10,100))},300):s||0===x||h(0);let M=()=>{k.current&&(k.current.style.height="auto",k.current.style.height="".concat(Math.min(k.current.scrollHeight,120),"px"))},E=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0});b.current=e;let t=new MediaRecorder(e);N.current=t,v.current=[],t.ondataavailable=e=>{v.current.push(e.data)},t.onstop=()=>{let e=new Blob(v.current,{type:"audio/wav"}),t=URL.createObjectURL(e);j(t)},t.start(),g(!0),C.current=Date.now()}catch(e){console.error("Error accessing microphone:",e),ed.oR.error("Could not access microphone")}};return(0,a.jsx)(S,{className:"rounded-none border-x-0 border-b-0 shadow-none",children:(0,a.jsxs)(R,{className:"p-3",children:[(0,a.jsx)(e_.N,{children:(l||i)&&(0,a.jsxs)(eZ.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"mb-3 p-2 bg-muted/30 rounded-md",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"text-xs font-medium text-muted-foreground mb-1",children:i?"Editing message":"Replying to ".concat((null==l?void 0:l.senderId)==="reddevil212"?"yourself":"")}),(0,a.jsx)(P,{variant:"ghost",size:"sm",onClick:i?u:m,className:"h-6 w-6 p-0",children:(0,a.jsx)(Q.A,{className:"h-3.5 w-3.5"})})]}),(0,a.jsx)("div",{className:"text-sm text-foreground/80 truncate max-w-[90%]",children:(null==l?void 0:l.fileUrl)?(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("img",{src:l.fileUrl,alt:"Replied media",className:"w-10 h-10 object-cover rounded"}),(0,a.jsx)("span",{children:l.fileName||"Media file"})]}):(null==l?void 0:l.text)||"Media message"})]})}),p&&(0,a.jsxs)("div",{className:"mb-3 p-2 bg-muted/30 rounded-md",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Voice Message Preview"}),(0,a.jsxs)("div",{className:"flex space-x-1",children:[(0,a.jsxs)(P,{variant:"ghost",size:"sm",onClick:()=>{p&&v.current.length>0&&(c(new Blob(v.current,{type:"audio/wav"}),y),j(null),v.current=[],w(0))},className:"h-7 px-2",children:[(0,a.jsx)(eN.A,{className:"h-3.5 w-3.5 text-primary mr-1"}),(0,a.jsx)("span",{className:"text-xs",children:"Send"})]}),(0,a.jsxs)(P,{variant:"ghost",size:"sm",onClick:()=>{j(null),v.current=[],w(0),b.current&&(b.current.getTracks().forEach(e=>{e.stop()}),b.current=null)},className:"h-7 px-2",children:[(0,a.jsx)(ev.A,{className:"h-3.5 w-3.5 text-destructive mr-1"}),(0,a.jsx)("span",{className:"text-xs",children:"Discard"})]})]})]}),(0,a.jsx)(eH,{src:p,initialDuration:y})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(ef,{children:(0,a.jsxs)(eE,{children:[(0,a.jsx)(eI,{asChild:!0,children:(0,a.jsxs)(eg,{children:[(0,a.jsx)(ep,{asChild:!0,children:(0,a.jsx)(P,{variant:"ghost",size:"sm",className:"text-muted-foreground",children:(0,a.jsx)(eb.A,{className:"h-5 w-5"})})}),(0,a.jsx)(ej,{children:(0,a.jsx)("p",{className:"dark: bg-black dark:text-white",children:"Add emoji"})})]})}),(0,a.jsx)(eT,{className:"w-64 p-0",children:(0,a.jsx)(eG,{onEmojiSelect:e=>n(t+e)})})]})}),(0,a.jsx)(ef,{children:(0,a.jsxs)(eg,{children:[(0,a.jsx)(ep,{asChild:!0,children:(0,a.jsx)(P,{variant:"ghost",size:"sm",onClick:o,disabled:s||!!i,className:"text-muted-foreground ".concat(s||i?"opacity-50":""),children:(0,a.jsx)(eC.A,{className:"h-5 w-5 ".concat(s?"text-primary animate-pulse":"")})})}),(0,a.jsx)(ej,{children:(0,a.jsx)("p",{className:"dark: bg-black dark:text-white",children:i?"Can't attach files when editing":"Attach file"})})]})}),(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(eM,{ref:k,placeholder:s?"Uploading file...":i?"Edit your message":l?"Type your reply":"Type a message",className:"w-full resize-none min-h-[40px] max-h-[120px] text-sm bg-muted/50",value:t,onChange:e=>{n(e.target.value),M()},disabled:s,onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),d())},rows:1})}),(0,a.jsx)(ef,{children:t.trim()||i?(0,a.jsxs)(eg,{children:[(0,a.jsx)(ep,{asChild:!0,children:(0,a.jsx)(P,{variant:"ghost",size:"sm",onClick:d,disabled:s,className:"text-primary hover:text-primary hover:bg-primary/10",children:(0,a.jsx)(eN.A,{className:"h-5 w-5"})})}),(0,a.jsx)(ej,{children:(0,a.jsx)("p",{className:"dark: bg-black dark:text-white",children:i?"Save edit":"Send message"})})]}):(0,a.jsxs)(eg,{children:[(0,a.jsx)(ep,{asChild:!0,children:(0,a.jsx)(P,{variant:"ghost",size:"sm",onClick:f?()=>{N.current&&"inactive"!==N.current.state&&N.current.stop(),b.current&&(b.current.getTracks().forEach(e=>{e.stop()}),b.current=null),C.current&&(w((Date.now()-C.current)/1e3),C.current=null),g(!1)}:E,disabled:!!i,className:"text-muted-foreground ".concat(f?"text-red-500 animate-pulse":""," ").concat(i?"opacity-50":""),children:f?(0,a.jsx)(eS.A,{className:"h-5 w-5"}):(0,a.jsx)(ek.A,{className:"h-5 w-5"})})}),(0,a.jsx)(ej,{children:(0,a.jsx)("p",{className:"dark: bg-black dark:text-white",children:i?"Can't record when editing":f?"Stop recording":"Record voice message"})})]})})]}),s&&(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)(eU,{value:x,className:"h-1"}),(0,a.jsxs)("p",{className:"text-xs text-primary mt-1 text-center",children:["Uploading file... ",x,"%"]})]})]})})};var eB=s(5565),eV=s(4955),eY=s(2316),eQ=s(3653),eW=s(4081),eq=s(7711);let eK=s(2975).b,eX=(0,eq.default)(()=>s.e(159).then(s.t.bind(s,2159,23)),{loadableGenerated:{webpack:()=>[2159]},ssr:!1,loading:()=>(0,a.jsx)("div",{className:"w-full h-[180px] bg-muted/30 animate-pulse rounded-md flex items-center justify-center",children:(0,a.jsx)(eV.A,{className:"h-8 w-8 text-muted-foreground/50"})})}),e$=e=>{let{message:t}=e,{fileUrl:s,fileType:l,fileName:i,text:n}=t,[d,o]=(0,r.useState)(null),c=(0,r.useRef)(null);return((0,r.useEffect)(()=>{if((null==l?void 0:l.startsWith("audio/"))&&!t.duration&&s){let e=new Audio(s);c.current=e;let t=()=>{o(e.duration)};return e.addEventListener("loadedmetadata",t),()=>{e.removeEventListener("loadedmetadata",t),e.src=""}}},[s,l,t.duration]),s&&l)?l.startsWith("image/")?(0,a.jsxs)(S,{className:"my-2 overflow-hidden",children:[(0,a.jsx)(R,{className:"p-0",children:(0,a.jsx)(eK,{ratio:4/3,children:(0,a.jsx)("img",{src:s,alt:i||n,className:"object-cover w-full h-full rounded-t-md"})})}),(0,a.jsxs)(E,{className:"p-2 flex items-center justify-between bg-muted/20",children:[(0,a.jsxs)(M,{className:"text-xs flex items-center",children:[(0,a.jsx)(eY.A,{size:12,className:"mr-1"})," ",i||"Image"]}),(0,a.jsx)(P,{variant:"ghost",size:"sm",className:"h-6 text-xs",asChild:!0,children:(0,a.jsx)("a",{href:s,target:"_blank",rel:"noopener noreferrer",children:"Open"})})]})]}):l.startsWith("video/")?(0,a.jsxs)(S,{className:"my-2 overflow-hidden",children:[(0,a.jsx)(R,{className:"p-0",children:(0,a.jsx)(eK,{ratio:16/9,children:(0,a.jsx)(eX,{url:s,controls:!0,width:"100%",height:"100%",className:"react-player"})})}),(0,a.jsxs)(E,{className:"p-2 flex items-center justify-between bg-muted/20",children:[(0,a.jsxs)(M,{className:"text-xs flex items-center",children:[(0,a.jsx)(eV.A,{size:12,className:"mr-1"})," ",i||"Video"]}),(0,a.jsx)(P,{variant:"ghost",size:"sm",className:"h-6 text-xs",asChild:!0,children:(0,a.jsx)("a",{href:s,target:"_blank",rel:"noopener noreferrer",children:"Download"})})]})]}):l.startsWith("audio/")?t.duration||d?(0,a.jsx)(S,{className:"my-2",children:(0,a.jsxs)(R,{className:"p-4 ",children:[(0,a.jsx)("div",{className:"rounded-lg bg-muted/20 p-2",children:(0,a.jsx)(eH,{src:s,initialDuration:t.duration||d||0,className:"w-full"})}),(0,a.jsxs)(E,{className:"px-0 pt-2 pb-0 flex items-center justify-between",children:[(0,a.jsxs)(M,{className:"text-xs flex items-center",children:[(0,a.jsx)(eQ.A,{size:12,className:"mr-1"})," ",i||"Audio"]}),(0,a.jsx)(P,{variant:"ghost",size:"sm",className:"h-6 text-xs",asChild:!0,children:(0,a.jsx)("a",{href:s,target:"_blank",rel:"noopener noreferrer",children:"Download"})})]})]})}):(0,a.jsx)(S,{className:"my-2",children:(0,a.jsxs)(R,{className:"p-4",children:[(0,a.jsx)("div",{className:"rounded-lg bg-muted/20 p-2",children:(0,a.jsx)("div",{className:"flex items-center justify-center py-4",children:(0,a.jsx)(ex,{className:"h-8 w-48"})})}),(0,a.jsxs)(E,{className:"px-0 pt-2 pb-0 flex items-center justify-between",children:[(0,a.jsxs)(M,{className:"text-xs flex items-center",children:[(0,a.jsx)(eQ.A,{size:12,className:"mr-1"})," ",i||"Audio"]}),(0,a.jsx)(ex,{className:"h-6 w-16"})]})]})}):(0,a.jsx)(S,{className:"my-2",children:(0,a.jsx)(R,{className:"p-4",children:(0,a.jsx)(P,{variant:"outline",className:"w-full justify-start",asChild:!0,children:(0,a.jsxs)("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"flex items-center p-3 rounded-lg",children:[(0,a.jsx)(eW.A,{className:"mr-2 h-6 w-6 text-primary"}),(0,a.jsxs)("div",{className:"overflow-hidden flex-1",children:[(0,a.jsx)("p",{className:"font-medium text-sm truncate",children:i||n}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Click to open"})]})]})})})}):null};var e0=s(3768),e1=s(4858),e2=s(3920),e5=s(6764),e4=s(937),e3=s(8867),e6=s(3565);let e9=e4.bL,e8=e4.l9;e4.YJ,e4.ZL,e4.Pb,e4.z6,r.forwardRef((e,t)=>{let{className:s,inset:r,children:l,...i}=e;return(0,a.jsxs)(e4.ZP,{ref:t,className:C("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",s),...i,children:[l,(0,a.jsx)(Y.A,{className:"ml-auto"})]})}).displayName=e4.ZP.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(e4.G5,{ref:t,className:C("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...r})}).displayName=e4.G5.displayName;let e7=r.forwardRef((e,t)=>{let{className:s,sideOffset:r=4,...l}=e;return(0,a.jsx)(e4.ZL,{children:(0,a.jsx)(e4.UC,{ref:t,sideOffset:r,className:C("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...l})})});e7.displayName=e4.UC.displayName;let te=r.forwardRef((e,t)=>{let{className:s,inset:r,...l}=e;return(0,a.jsx)(e4.q7,{ref:t,className:C("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",r&&"pl-8",s),...l})});te.displayName=e4.q7.displayName,r.forwardRef((e,t)=>{let{className:s,children:r,checked:l,...i}=e;return(0,a.jsxs)(e4.H_,{ref:t,className:C("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:l,...i,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(e4.VF,{children:(0,a.jsx)(e3.A,{className:"h-4 w-4"})})}),r]})}).displayName=e4.H_.displayName,r.forwardRef((e,t)=>{let{className:s,children:r,...l}=e;return(0,a.jsxs)(e4.hN,{ref:t,className:C("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...l,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(e4.VF,{children:(0,a.jsx)(e6.A,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=e4.hN.displayName,r.forwardRef((e,t)=>{let{className:s,inset:r,...l}=e;return(0,a.jsx)(e4.JU,{ref:t,className:C("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",s),...l})}).displayName=e4.JU.displayName;let tt=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(e4.wv,{ref:t,className:C("-mx-1 my-1 h-px bg-muted",s),...r})});tt.displayName=e4.wv.displayName;let ts=[{emoji:"\uD83D\uDC4D",label:"Like"},{emoji:"❤️",label:"Love"},{emoji:"\uD83D\uDE02",label:"Laugh"},{emoji:"\uD83D\uDE2E",label:"Wow"},{emoji:"\uD83D\uDE22",label:"Sad"},{emoji:"\uD83D\uDE4F",label:"Thank you"}],ta=e=>{let{message:t,currentUser:s,isLastMessage:l,onEditMessage:i,onDeleteMessage:n,onReplyToMessage:d,onReactToMessage:o}=e,[c,m]=(0,r.useState)(!1),[u,x]=(0,r.useState)(!1),h=s&&t.senderId===s.uid,f=t.reactions&&0!==t.reactions.length?t.reactions.reduce((e,t)=>(e[t.emoji]||(e[t.emoji]={count:0,hasCurrentUser:!1}),e[t.emoji].count++,s&&t.userId===s.uid&&(e[t.emoji].hasCurrentUser=!0),e),{}):{};return(0,a.jsxs)(eZ.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.2},className:"group relative flex mb-2 ".concat(h?"justify-end":"justify-start"),onMouseEnter:()=>m(!0),onMouseLeave:()=>{m(!1),x(!1)},children:[t.replyToId&&(0,a.jsx)("div",{className:"absolute -top-4 ".concat(h?"right-4":"left-4"," \n          text-xs text-muted-foreground cursor-pointer"),onClick:()=>{let e=document.getElementById("message-".concat(t.replyToId));e&&e.scrollIntoView({behavior:"smooth",block:"center"})}}),(0,a.jsxs)("div",{className:"max-w-[75%] rounded-lg px-3 py-2 shadow-sm ".concat(h?"bg-primary text-primary-foreground":"bg-muted/80 text-foreground"),id:"message-".concat(t.id),children:[t.replyToId&&t.replyToText&&(0,a.jsx)("div",{className:"mb-1 pb-1 text-xs ".concat(h?"border-b border-primary-foreground/20":"border-b border-foreground/20"),children:(0,a.jsxs)("div",{className:"opacity-70 font-medium flex items-center space-x-2",children:[t.replyToFileUrl&&(0,a.jsx)(eB.default,{src:t.replyToFileUrl,alt:"Replied media",width:50,height:10,className:"object-cover rounded cursor-pointer",style:{width:"auto",height:"auto"},onClick:()=>{let e=document.getElementById("message-".concat(t.replyToId));e&&e.scrollIntoView({behavior:"smooth",block:"center"})}}),(0,a.jsx)("span",{children:t.replyToText})]})}),t.fileUrl&&t.fileType&&(0,a.jsx)(e$,{message:t}),(0,a.jsxs)("p",{className:"text-sm whitespace-pre-wrap break-words",children:[t.text,t.isEdited&&(0,a.jsx)("span",{className:"text-[10px] opacity-70 ml-1",children:"(edited)"})]}),(0,a.jsxs)("div",{className:"text-[10px] mt-1 flex items-center justify-end\n          ".concat(h?"text-primary-foreground/70":"text-muted-foreground"),children:[q(t.timestamp),h&&(0,a.jsx)("span",{className:"ml-1",children:t.read?"✓✓":"✓"})]}),Object.keys(f).length>0&&(0,a.jsx)("div",{className:"flex flex-wrap mt-1 gap-1",children:Object.entries(f).map(e=>{let[t,{count:s,hasCurrentUser:r}]=e;return(0,a.jsxs)("div",{className:"text-xs rounded-full px-1 py-0.5 flex items-center gap-0.5 ".concat(r?h?"bg-primary-foreground/20 text-primary-foreground":"bg-primary/20 text-primary":h?"bg-primary-foreground/10 text-primary-foreground/80":"bg-muted-foreground/10 text-muted-foreground"),children:[(0,a.jsx)("span",{children:t}),s>1&&(0,a.jsx)("span",{children:s})]},t)})})]}),(0,a.jsx)(e_.N,{children:c&&(0,a.jsxs)(eZ.P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"absolute -top-5 ".concat(h?"right-0":"left-0"," \n              bg-background rounded-full shadow-md p-0.5 flex items-center gap-0.5 z-10"),children:[(0,a.jsx)(ef,{children:(0,a.jsxs)(eg,{children:[(0,a.jsx)(ep,{asChild:!0,children:(0,a.jsx)("button",{onClick:()=>d(t),className:"p-1.5 hover:bg-muted rounded-full",children:(0,a.jsx)(e0.A,{className:"h-3.5 w-3.5 text-muted-foreground"})})}),(0,a.jsx)(ej,{side:"top",children:(0,a.jsx)("p",{className:"text-xs",children:"Reply"})})]})}),(0,a.jsx)(ef,{children:(0,a.jsxs)(eE,{open:u,onOpenChange:x,children:[(0,a.jsxs)(eg,{children:[(0,a.jsx)(ep,{asChild:!0,children:(0,a.jsx)(eI,{asChild:!0,children:(0,a.jsx)("button",{className:"p-1.5 hover:bg-muted rounded-full",children:(0,a.jsx)(eb.A,{className:"h-3.5 w-3.5 text-muted-foreground"})})})}),(0,a.jsx)(ej,{side:"top",children:(0,a.jsx)("p",{className:"text-xs",children:"React"})})]}),(0,a.jsx)(eT,{className:"p-1 flex gap-0.5",side:"top",children:ts.map(e=>{var r;let l=null===(r=t.reactions)||void 0===r?void 0:r.some(t=>t.emoji===e.emoji&&t.userId===(null==s?void 0:s.uid));return(0,a.jsx)(ef,{children:(0,a.jsxs)(eg,{children:[(0,a.jsx)(ep,{asChild:!0,children:(0,a.jsx)("button",{onClick:()=>{o(t.id,e.emoji),x(!1)},className:"p-1.5 rounded-full transition-colors ".concat(l?"bg-primary/20":"hover:bg-muted"),children:e.emoji})}),(0,a.jsx)(ej,{side:"top",className:"text-xs",children:e.label})]})},e.emoji)})})]})}),(0,a.jsxs)(e9,{children:[(0,a.jsx)(e8,{asChild:!0,children:(0,a.jsx)("button",{className:"p-1.5 hover:bg-muted rounded-full",children:(0,a.jsx)(e1.A,{className:"h-3.5 w-3.5 text-muted-foreground"})})}),(0,a.jsxs)(e7,{align:h?"end":"start",children:[(0,a.jsxs)(te,{onClick:()=>{t.text&&(navigator.clipboard.writeText(t.text),ed.oR.success("Copied to clipboard"))},children:[(0,a.jsx)(e2.A,{className:"h-4 w-4 mr-2"}),"Copy"]}),h&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(tt,{}),(0,a.jsxs)(te,{onClick:()=>{t.id&&i(t.id,t.text||"")},children:[(0,a.jsx)(e5.A,{className:"h-4 w-4 mr-2"}),"Edit"]}),(0,a.jsxs)(te,{onClick:()=>{t.id&&n(t.id,l)},className:"text-destructive focus:text-destructive",children:[(0,a.jsx)(ev.A,{className:"h-4 w-4 text-red-600 mr-2"}),(0,a.jsx)("p",{className:"text-red-600",children:"Delete"})]})]})]})]})]})})]})},tr=e=>{let{messages:t,currentUser:s,onEditMessage:r,onDeleteMessage:l,onReactToMessage:i,onReplyToMessage:n}=e;if(0===t.length)return(0,a.jsx)("div",{className:"h-full flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center text-muted-foreground",children:[(0,a.jsx)("p",{className:"text-sm",children:"No messages yet"}),(0,a.jsx)("p",{className:"text-xs mt-1",children:"Send a message to start the conversation"})]})});let d=e=>e?t.find(t=>t.id===e):null;return(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsx)(e_.N,{initial:!1,children:t.map((e,o)=>(d(e.replyToId),(0,a.jsx)(ta,{message:e,currentUser:s,isLastMessage:o===t.length-1,onEditMessage:r,onDeleteMessage:l,onReactToMessage:i,onReplyToMessage:n},e.id||o)))})})},tl=e=>{let{onOpenSidebar:t}=e;return(0,a.jsxs)("div",{className:"h-full flex flex-col items-center justify-center p-4",children:[(0,a.jsxs)(P,{variant:"ghost",size:"sm",className:"md:hidden absolute top-3 left-3",onClick:t,children:[(0,a.jsx)(es.A,{className:"h-4 w-4 mr-2 text-gray-400"}),(0,a.jsx)("span",{className:"text-sm text-gray-400",children:"Chats"})]}),(0,a.jsxs)("div",{className:"text-center max-w-md",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(Z.A,{className:"h-8 w-8 text-white"})}),(0,a.jsx)("h2",{className:"text-xl font-bold text-white mb-2",children:"Memchat"}),(0,a.jsx)("p",{className:"text-sm text-gray-400",children:"Select a chat from the sidebar or search for a user to start a new conversation."})]})]})};var ti=s(7530),tn=s(1779);let td=e=>{let{className:t,...s}=e;return(0,a.jsx)(tn.YZ,{className:C("flex h-full w-full data-[panel-group-direction=vertical]:flex-col",t),...s})},to=tn.Zk,tc=e=>{let{withHandle:t,className:s,...r}=e;return(0,a.jsx)(tn.TW,{className:C("relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",s),...r,children:t&&(0,a.jsx)("div",{className:"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border",children:(0,a.jsx)(ti.A,{className:"h-2.5 w-2.5"})})})};var tm=s(3519);let tu=e=>{let{callerName:t}=e,{callState:s,answerCall:r,rejectCall:l}=g();return(0,a.jsx)("div",{className:"fixed inset-0 z-50 bg-black/75 flex items-center justify-center",children:(0,a.jsx)("div",{className:"bg-[#1e1d1d] rounded-lg p-6 max-w-sm w-full mx-4",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-4",children:"video"===s.callType?(0,a.jsx)(ei.A,{className:"w-8 h-8 text-white"}):(0,a.jsx)(el.A,{className:"w-8 h-8 text-white"})}),(0,a.jsxs)("h2",{className:"text-xl font-semibold text-white mb-2",children:["Incoming ",s.callType," call"]}),(0,a.jsx)("p",{className:"text-gray-400 mb-6",children:t}),(0,a.jsxs)("div",{className:"flex justify-center space-x-4",children:[(0,a.jsx)(P,{variant:"ghost",size:"lg",className:"rounded-full p-4 bg-red-500",onClick:l,children:(0,a.jsx)(tm.A,{className:"w-6 h-6 text-white"})}),(0,a.jsx)(P,{variant:"ghost",size:"lg",className:"rounded-full p-4 bg-green-500",onClick:r,children:(0,a.jsx)(el.A,{className:"w-6 h-6 text-white"})})]})]})})})};var tx=s(7156),th=s(8716);let tf=e=>{let{recipientName:t}=e,{callState:s,endCall:l}=g(),[i,n]=r.useState(!1),[d,o]=r.useState(!1),c=r.useRef(null),m=r.useRef(null),u=r.useRef(null);return r.useEffect(()=>{c.current&&s.localStream&&(c.current.srcObject=s.localStream)},[s.localStream]),r.useEffect(()=>{m.current&&s.remoteStream&&(m.current.srcObject=s.remoteStream),u.current&&s.remoteStream&&(u.current.srcObject=s.remoteStream)},[s.remoteStream]),(0,a.jsx)("div",{className:"fixed inset-0 z-50 bg-black/75 flex items-center justify-center",children:(0,a.jsx)("div",{className:"bg-[#1e1d1d] rounded-lg p-4 w-full max-w-4xl",children:(0,a.jsxs)("div",{className:"flex flex-col h-[600px]",children:[(0,a.jsxs)("div",{className:"flex-1 relative bg-black rounded-lg overflow-hidden",children:["video"===s.callType?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("video",{ref:m,className:"w-full h-full object-cover",autoPlay:!0,playsInline:!0}),(0,a.jsx)("video",{ref:c,className:"absolute bottom-4 right-4 w-48 h-36 object-cover rounded-lg",autoPlay:!0,playsInline:!0,muted:!0})]}):(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-24 h-24 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(el.A,{className:"w-12 h-12 text-white"})}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-white",children:t}),(0,a.jsx)("p",{className:"text-gray-400",children:"Audio Call"})]})}),"audio"===s.callType&&(0,a.jsx)("audio",{ref:u,autoPlay:!0})]}),(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-4 mt-4",children:[(0,a.jsx)(P,{variant:"ghost",size:"lg",className:"rounded-full p-4 ".concat(i?"bg-red-500":"bg-gray-700"),onClick:()=>{s.localStream&&(s.localStream.getAudioTracks().forEach(e=>{e.enabled=!e.enabled,console.log("Audio track enabled: ".concat(e.enabled))}),n(!i))},children:i?(0,a.jsx)(tx.A,{className:"w-6 h-6 text-white"}):(0,a.jsx)(ek.A,{className:"w-6 h-6 text-white"})}),(0,a.jsx)(P,{variant:"ghost",size:"lg",className:"rounded-full p-4 bg-red-500",onClick:l,children:(0,a.jsx)(tm.A,{className:"w-6 h-6 text-white"})}),"video"===s.callType&&(0,a.jsx)(P,{variant:"ghost",size:"lg",className:"rounded-full p-4 ".concat(d?"bg-red-500":"bg-gray-700"),onClick:()=>{s.localStream&&"video"===s.callType&&(s.localStream.getVideoTracks().forEach(e=>{e.enabled=!e.enabled,console.log("Video track enabled: ".concat(e.enabled))}),o(!d))},children:d?(0,a.jsx)(th.A,{className:"w-6 h-6 text-white"}):(0,a.jsx)(ei.A,{className:"w-6 h-6 text-white"})})]})]})})})};function tg(){let e=function(){let[e,t]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{let e=()=>{t(window.innerWidth<768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e}(),t=(0,r.useRef)(null),[s,n]=(0,r.useState)(!e),[d,o]=(0,r.useState)(null),[u,x]=(0,r.useState)([]),[f,p]=(0,r.useState)([]),[j,y]=(0,r.useState)(null),[w,v]=(0,r.useState)(null),[b,C]=(0,r.useState)([]),[k,M]=(0,r.useState)(""),[R,E]=(0,r.useState)(""),[I,T]=(0,r.useState)(!1),[A,U]=(0,r.useState)(null),[D,z]=(0,r.useState)(null),[L,P]=(0,r.useState)(e?0:25),[O,F]=(0,r.useState)(e?100:75),{callState:H,startCall:_,endCall:Z}=g();(0,r.useEffect)(()=>{let e=(0,l.hg)(c,async e=>{if(e){let t=await (0,i.x7)((0,i.H9)(m,"users",e.uid));if(t.exists()){let s=t.data();o({...s,displayName:s.displayName||e.displayName||"Unknown User",photoURL:s.photoURL||e.photoURL||null}),await (0,i.mZ)((0,i.H9)(m,"users",e.uid),{lastSeen:(0,i.O5)(),status:"online"})}else G()}else document.cookie="user_session=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",window.location.reload()});return()=>e()},[]),(0,r.useEffect)(()=>{if(!d)return;let e=(0,i.P)((0,i.rJ)(m,"users"),(0,i._M)("uid","!=",d.uid)),t=(0,i.aQ)(e,e=>{let t=[];e.forEach(e=>{t.push(e.data())}),x(t)});return()=>t()},[d]),(0,r.useEffect)(()=>{if(!d)return;let e=N.listenToChats(d.uid,p);return()=>e()},[d]),(0,r.useEffect)(()=>{if(!j){C([]);return}let e=N.listenToMessages(j.id,C,async e=>{d&&await (0,i.mZ)((0,i.H9)(m,"chats",j.id,"messages",e),{read:!0})});return()=>e()},[j,d]),(0,r.useEffect)(()=>{if(!j||!d||!u.length){v(null);return}let e=j.participants.find(e=>e!==d.uid);e&&v(u.find(t=>t.uid===e)||null)},[j,d,u]),(0,r.useEffect)(()=>{var e;null===(e=t.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[b]),(0,r.useEffect)(()=>{e?s?(P(100),F(0)):(P(0),F(100)):s?(P(25),F(75)):(P(0),F(100))},[s,e]),(0,r.useEffect)(()=>{U(null),z(null),M("")},[j]);let G=async()=>{try{d&&await (0,i.mZ)((0,i.H9)(m,"users",d.uid),{lastSeen:(0,i.O5)(),status:"offline"}),await (0,l.CI)(c),document.cookie="user_session=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",window.location.reload()}catch(e){(0,ed.oR)("Error signing out",{description:"Please try again"})}},J=async t=>{if(d)try{let s=await N.createOrGetChat(d.uid,t);y(s),e&&n(!1)}catch(e){(0,ed.oR)("Error starting chat",{description:"Please try again"})}},B=async()=>{if(k.trim()&&j&&d)try{A&&A.id?(await Q(A.id,k),U(null)):D&&D.id?(await N.sendReplyMessage(j.id,{senderId:d.uid,text:k,timestamp:new Date().toISOString(),read:!1,replyToId:D.id,replyToText:D.text||"Media message",replyToFileUrl:D.fileUrl||void 0},D),z(null)):await N.sendMessage(j.id,{senderId:d.uid,text:k,timestamp:new Date().toISOString(),read:!1}),M("")}catch(e){(0,ed.oR)("Error sending message",{description:"Please try again"})}},V=async e=>{if(e&&j&&d)try{T(!0);let t=await N.uploadFile(e,j.id),s={senderId:d.uid,text:"Sent ".concat(e.type.split("/")[0]),fileUrl:t,fileType:e.type,fileName:e.name,timestamp:new Date().toISOString(),read:!1};D&&D.id?(s.replyToId=D.id,s.replyToText=D.text||"Media message",await N.sendReplyMessage(j.id,s,D),z(null)):await N.sendMessage(j.id,s),(0,ed.oR)("File uploaded",{description:"File has been sent successfully."})}catch(e){console.error("Error uploading file:",e),(0,ed.oR)("Upload failed",{description:"Could not upload file. Please try again."})}finally{T(!1)}},Y=async(e,t)=>{if(j&&d)try{T(!0);let s=await N.uploadFile(e,j.id),a={senderId:d.uid,text:"Sent a voice message",fileUrl:s,fileType:"audio/wav",duration:t,fileName:"voice_message.wav",timestamp:new Date().toISOString(),read:!1};D&&D.id?(a.replyToId=D.id,a.replyToText=D.text||"Media message",await N.sendReplyMessage(j.id,a,D),z(null)):await N.sendMessage(j.id,a),(0,ed.oR)("Voice message sent",{description:"Voice message has been sent successfully."})}catch(e){console.error("Error sending voice message:",e),(0,ed.oR)("Send failed",{description:"Could not send voice message. Please try again."})}finally{T(!1)}},Q=async(e,t)=>{if(j&&d)try{let s=b.find(t=>t.id===e);s&&s.senderId===d.uid&&(await N.editMessage(j.id,e,t),(0,ed.oR)("Message edited",{description:"Your message has been updated"}))}catch(e){console.error("Error editing message:",e),(0,ed.oR)("Edit failed",{description:"Could not edit the message. Please try again."})}},W=async(e,t)=>{if(j&&d)try{let s=b.find(t=>t.id===e);s&&s.senderId===d.uid&&(await N.deleteMessage(j.id,e,t),(0,ed.oR)("Message deleted",{description:"Your message has been removed"}))}catch(e){console.error("Error deleting message:",e),(0,ed.oR)("Delete failed",{description:"Could not delete the message. Please try again."})}},q=async(e,t)=>{if(j&&d)try{await N.toggleReaction(j.id,e,d.uid,t)}catch(e){console.error("Error reacting to message:",e),(0,ed.oR)("Reaction failed",{description:"Could not react to the message. Please try again."})}},K=u.filter(e=>e.displayName.toLowerCase().includes(R.toLowerCase())),X=()=>{n(e=>!e)};return(0,a.jsxs)(S,{className:"h-screen bg-black lg:max-w-[1700px] sm:max-w-[320px] overflow-hidden",onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDrop:e=>{e.preventDefault(),e.stopPropagation();let t=e.dataTransfer.files[0];t&&V(t)},children:[(0,a.jsxs)(td,{direction:"horizontal",className:"h-full bg-black rounded-lg border-0",onLayout:t=>{e||(P(t[0]),F(t[1]))},children:[(0,a.jsx)(to,{defaultSize:L,minSize:e?0:20,maxSize:e?100:40,collapsible:!e,collapsedSize:0,onCollapse:()=>{n(!1)},onExpand:()=>{n(!0)},className:"".concat(e&&!s?"hidden":""),children:(0,a.jsx)("div",{className:"h-full ",children:(0,a.jsx)(et,{isOpen:!0,onClose:()=>n(!1),currentUser:d,users:K,chats:f,selectedChat:j,searchQuery:R,onSearchChange:E,onSignOut:G,onChatSelect:t=>{y(t),e&&n(!1)},onStartChat:J})})}),(!e||s)&&(0,a.jsx)(tc,{}),(0,a.jsx)(to,{defaultSize:O,minSize:30,className:"".concat(e&&s?"hidden":""),children:(0,a.jsx)("div",{className:"flex flex-col h-full",children:j&&w?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ew,{user:w,onOpenSidebar:X,showMenuButton:!0,onCall:e=>_(w.uid,e)}),(0,a.jsxs)("div",{className:"flex-1 scrollbar-thin overflow-y-auto p-4",children:[(0,a.jsx)(e_.N,{initial:!1,children:(0,a.jsx)(tr,{messages:b,currentUser:d,formatTime:e=>new Date(e).toLocaleTimeString(),onEditMessage:(e,t)=>{let s=b.find(t=>t.id===e);s&&(U(s),M(t),z(null))},onDeleteMessage:W,onReactToMessage:q,onReplyToMessage:e=>{z(e),U(null),setTimeout(()=>{let e=document.querySelector("textarea");e&&e.focus()},100)}})}),(0,a.jsx)("div",{ref:t})]}),(0,a.jsx)(eJ,{message:k,isUploading:I,replyingTo:D,editingMessage:A,onMessageChange:M,onSendMessage:B,onFileSelect:()=>{let e=document.createElement("input");e.type="file",e.accept="image/*, video/*, audio/*, .pdf, .doc, .docx, .txt",e.click(),e.onchange=e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];s&&V(s)}},onVoiceMessageSend:Y,onCancelReply:()=>{z(null)},onCancelEdit:()=>{U(null),M("")}})]}):(0,a.jsx)(tl,{onOpenSidebar:X})})})]}),(0,a.jsx)(h.Consumer,{children:e=>{if(!e)return null;let{callState:t,endCall:s}=e;if(t.isIncomingCall&&!t.callAccepted){let e=u.find(e=>e.uid===t.callerId);return(0,a.jsx)(tu,{callerName:(null==e?void 0:e.displayName)||"Unknown Caller"})}if(t.isOutgoingCall||t.callAccepted){let e=u.find(e=>e.uid===(t.calleeId||t.callerId));return(0,a.jsx)(tf,{recipientName:(null==e?void 0:e.displayName)||"Unknown User"})}return null}})]})}function tp(){let[e,t]=(0,r.useState)(null);return((0,r.useEffect)(()=>{let e=(0,l.hg)(c,async e=>{if(e){let s=await (0,i.x7)((0,i.H9)(m,"users",e.uid));if(s.exists()){let a=s.data();t({...a,displayName:a.displayName||e.displayName||"Unknown User",lastSeen:new Date().toISOString(),photoURL:a.photoURL||e.photoURL||null})}}});return()=>e()},[]),e)?(0,a.jsx)(f,{currentUser:e,children:(0,a.jsx)(tg,{})}):(0,a.jsx)(S,{className:"flex items-center justify-center min-h-screen bg-black animate-fadeIn border-0",children:(0,a.jsxs)(R,{className:"text-center bg-black relative w-full",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-background blur-lg opacity-50"}),(0,a.jsx)(k,{className:"text-4xl font-semibold text-foreground mb-4 animate-pulse",children:"Be patient, your conversations are loading..."}),(0,a.jsx)("div",{className:"w-12 h-12 border-4 border-t-transparent border-primary rounded-full animate-spin mx-auto"}),(0,a.jsx)(M,{className:"mt-4",children:"This might take a few moments. Thanks for your patience!"})]})})}var tj=s(2679),ty=s(9606),tw=s(3415);class tN{static async createUserDocument(e,t){let s={uid:e.uid,displayName:t||e.displayName||"Unknown",email:e.email||"",photoURL:e.photoURL,status:"Hey there! I'm using MemChat",createdAt:new Date().toISOString(),lastSeen:new Date().toISOString()};console.log(s),await (0,i.BN)((0,i.H9)(y,"users",e.uid),s)}static setUserSession(){document.cookie="user_session=true; path=/; max-age=86400; secure; samesite=strict"}static async emailSignIn(e){let{email:t,password:s}=e,a=await (0,l.x9)(j,t,s);return this.setUserSession(),a.user.uid}static async emailSignUp(e){let{email:t,password:s,name:a}=e,r=await (0,l.eJ)(j,t,s);await (0,l.r7)(r.user,{displayName:a}),await this.createUserDocument(r.user,a),this.setUserSession()}static async googleSignIn(){let e=await (0,l.df)(j,this.googleProvider),t=(0,i.H9)(y,"users",e.user.uid);(await (0,i.x7)(t)).exists()||await this.createUserDocument(e.user),this.setUserSession()}}tN.googleProvider=new l.HF;var tv=s(8629);let tb=tv.bL,tC=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(tv.B8,{ref:t,className:C("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",s),...r})});tC.displayName=tv.B8.displayName;let tS=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(tv.l9,{ref:t,className:C("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",s),...r})});tS.displayName=tv.l9.displayName;let tk=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(tv.UC,{ref:t,className:C("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...r})});tk.displayName=tv.UC.displayName;var tM=s(6195);let tR=(0,z.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),tE=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(tM.b,{ref:t,className:C(tR(),s),...r})});tE.displayName=tM.b.displayName;let tI=ty.Op,tT=r.createContext({}),tA=e=>{let{...t}=e;return(0,a.jsx)(tT.Provider,{value:{name:t.name},children:(0,a.jsx)(ty.xI,{...t})})},tU=()=>{let e=r.useContext(tT),t=r.useContext(tD),{getFieldState:s,formState:a}=(0,ty.xW)(),l=s(e.name,a);if(!e)throw Error("useFormField should be used within <FormField>");let{id:i}=t;return{id:i,name:e.name,formItemId:"".concat(i,"-form-item"),formDescriptionId:"".concat(i,"-form-item-description"),formMessageId:"".concat(i,"-form-item-message"),...l}},tD=r.createContext({}),tz=r.forwardRef((e,t)=>{let{className:s,...l}=e,i=r.useId();return(0,a.jsx)(tD.Provider,{value:{id:i},children:(0,a.jsx)("div",{ref:t,className:C("space-y-2",s),...l})})});tz.displayName="FormItem";let tL=r.forwardRef((e,t)=>{let{className:s,...r}=e,{error:l,formItemId:i}=tU();return(0,a.jsx)(tE,{ref:t,className:C(l&&"text-destructive",s),htmlFor:i,...r})});tL.displayName="FormLabel";let tP=r.forwardRef((e,t)=>{let{...s}=e,{error:r,formItemId:l,formDescriptionId:i,formMessageId:n}=tU();return(0,a.jsx)(D.DX,{ref:t,id:l,"aria-describedby":r?"".concat(i," ").concat(n):"".concat(i),"aria-invalid":!!r,...s})});tP.displayName="FormControl",r.forwardRef((e,t)=>{let{className:s,...r}=e,{formDescriptionId:l}=tU();return(0,a.jsx)("p",{ref:t,id:l,className:C("text-[0.8rem] text-muted-foreground",s),...r})}).displayName="FormDescription";let tO=r.forwardRef((e,t)=>{var s;let{className:r,children:l,...i}=e,{error:n,formMessageId:d}=tU(),o=n?String(null!==(s=null==n?void 0:n.message)&&void 0!==s?s:""):l;return o?(0,a.jsx)("p",{ref:t,id:d,className:C("text-[0.8rem] font-medium text-destructive",r),...i,children:o}):null});function tF(e){let{className:t=""}=e;return(0,a.jsxs)("svg",{className:t,viewBox:"0 0 24 24",children:[(0,a.jsx)("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),(0,a.jsx)("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),(0,a.jsx)("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),(0,a.jsx)("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]})}tO.displayName="FormMessage";var tH=s(434);let t_=r.forwardRef((e,t)=>{let{className:s,orientation:r="horizontal",decorative:l=!0,...i}=e;return(0,a.jsx)(tH.b,{ref:t,decorative:l,orientation:r,className:C("shrink-0 bg-border","horizontal"===r?"h-[1px] w-full":"h-full w-[1px]",s),...i})});t_.displayName=tH.b.displayName;var tZ=s(7725),tG=s(2104),tJ=s(7113),tB=s(2413);let tV=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(tB.bL,{className:C("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...r,ref:t,children:(0,a.jsx)(tB.zi,{className:C("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})})});tV.displayName=tB.bL.displayName;let tY=tw.Ik({email:tw.Yj().email({message:"Please enter a valid email address"}),password:tw.Yj().min(1,{message:"Password is required"})}),tQ=tw.Ik({name:tw.Yj().min(1,{message:"Name is required"}),email:tw.Yj().email({message:"Please enter a valid email address"}),password:tw.Yj().min(6,{message:"Password must be at least 6 characters"})});function tW(){let[e,t]=(0,r.useState)(null),[s,l]=(0,r.useState)(!1),[i,n]=(0,r.useState)(!1),{theme:d,setTheme:o}=(0,tJ.D)();(0,r.useEffect)(()=>{n(!0)},[]);let c=(0,ty.mN)({resolver:(0,tj.u)(tY),defaultValues:{email:"",password:""}}),m=(0,ty.mN)({resolver:(0,tj.u)(tQ),defaultValues:{name:"",email:"",password:""}}),u=(0,r.useCallback)(async e=>{l(!0),t(null);try{await tN.emailSignIn(e),c.reset(),window.location.reload()}catch(e){t(e.message||"Failed to login")}finally{l(!1)}},[c]),x=(0,r.useCallback)(async e=>{l(!0),t(null);try{await tN.emailSignUp(e),m.reset(),window.location.reload()}catch(e){t(e.message||"Failed to register")}finally{l(!1)}},[m]),h=(0,r.useCallback)(async()=>{l(!0),t(null);try{await tN.googleSignIn(),window.location.reload()}catch(e){t(e.message||"Failed to login with Google")}finally{l(!1)}},[]);return i?(0,a.jsx)(e_.N,{mode:"wait",children:(0,a.jsxs)(eZ.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.5},className:"flex flex-col items-center justify-center min-h-screen bg-white dark:bg-black text-black dark:text-white p-6 md:p-8",children:[(0,a.jsxs)("div",{className:"absolute top-4 right-4 flex items-center space-x-2",children:[(0,a.jsx)(tV,{checked:"dark"===d,onCheckedChange:()=>o("dark"===d?"light":"dark"),"aria-label":"Toggle theme"}),(0,a.jsx)(tZ.A,{className:"h-5 w-5"}),(0,a.jsx)(tG.A,{className:"h-5 w-5"})]}),(0,a.jsxs)(eZ.P.div,{initial:{scale:.95},animate:{scale:1},transition:{duration:.3},className:"flex flex-col items-center mb-8",children:[(0,a.jsx)("div",{className:"w-20 h-20 rounded-full  flex items-center justify-center mb-4",children:(0,a.jsx)(Z.A,{className:"h-10 w-10"})}),(0,a.jsx)("h1",{className:"text-4xl font-bold tracking-tight",children:"MemChat"}),(0,a.jsx)("p",{className:"mt-2",children:"Connect seamlessly. Chat endlessly."})]}),(0,a.jsxs)(S,{className:"w-full max-w-lg shadow-lg border-0 overflow-hidden bg-white dark:bg-black",children:[(0,a.jsx)(R,{className:"p-0",children:(0,a.jsxs)(tb,{defaultValue:"login",className:"w-full",children:[(0,a.jsxs)(tC,{className:"grid dark:bg-black w-full grid-cols-2 h-14",children:[(0,a.jsxs)(tS,{value:"login",className:"text-base relative",children:["Sign In","dark"===d&&(0,a.jsx)(eZ.P.div,{layoutId:"outline",className:"absolute inset-0 ",transition:{type:"spring",stiffness:500,damping:30}}),"light"===d&&(0,a.jsx)(eZ.P.div,{layoutId:"outline",className:"absolute inset-0 ",transition:{type:"spring",stiffness:500,damping:30}})]}),(0,a.jsxs)(tS,{value:"register",className:"text-base relative",children:["Create Account","dark"===d&&(0,a.jsx)(eZ.P.div,{layoutId:"outline",className:"absolute inset-0 ",transition:{type:"spring",stiffness:500,damping:30}}),"light"===d&&(0,a.jsx)(eZ.P.div,{layoutId:"outline",className:"absolute inset-0 ",transition:{type:"spring",stiffness:500,damping:30}})]})]}),(0,a.jsxs)("div",{className:"p-6",children:[e&&(0,a.jsx)(eZ.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"bg-gray-100 dark:bg-gray-800 border  dark:border-gray-600 text-red-700 px-4 py-3 rounded-md mb-4 text-sm",children:e}),(0,a.jsx)(tk,{value:"login",className:"mt-0 pt-2",children:(0,a.jsx)(eZ.P.div,{initial:{x:100,opacity:0},animate:{x:0,opacity:1},exit:{x:-100,opacity:0},transition:{type:"spring",stiffness:500,damping:30},children:(0,a.jsx)(tI,{...c,children:(0,a.jsxs)("form",{onSubmit:c.handleSubmit(u),className:"space-y-5",children:[(0,a.jsx)(tA,{control:c.control,name:"email",render:e=>{let{field:t}=e;return(0,a.jsxs)(tz,{children:[(0,a.jsx)(tL,{className:"text-sm font-medium",children:"Email"}),(0,a.jsx)(tP,{children:(0,a.jsx)(O,{placeholder:"name@example.com",type:"email",className:"h-11",...t})}),(0,a.jsx)(tO,{})]})}}),(0,a.jsx)(tA,{control:c.control,name:"password",render:e=>{let{field:t}=e;return(0,a.jsxs)(tz,{children:[(0,a.jsx)(tL,{className:"text-sm font-medium",children:"Password"}),(0,a.jsx)(tP,{children:(0,a.jsx)(O,{placeholder:"••••••••",type:"password",className:"h-11",...t})}),(0,a.jsx)(tO,{})]})}}),(0,a.jsx)(P,{type:"submit",className:"w-full h-11 font-medium",disabled:s,children:s?"Authenticating...":"Sign In"}),(0,a.jsxs)("div",{className:"relative my-5",children:[(0,a.jsx)(t_,{}),(0,a.jsx)("span",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 bg-white dark:bg-black px-2 text-xs",children:"OR CONTINUE WITH"})]}),(0,a.jsx)(P,{type:"button",variant:"outline",className:"w-full h-11 font-medium",onClick:h,disabled:s,children:(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,a.jsx)(tF,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:"Google"})]})})]})})})}),(0,a.jsx)(tk,{value:"register",className:"mt-0 pt-2",children:(0,a.jsx)(eZ.P.div,{initial:{x:-100,opacity:0},animate:{x:0,opacity:1},exit:{x:100,opacity:0},transition:{type:"spring",stiffness:500,damping:30},children:(0,a.jsx)(tI,{...m,children:(0,a.jsxs)("form",{onSubmit:m.handleSubmit(x),className:"space-y-5",children:[(0,a.jsx)(tA,{control:m.control,name:"name",render:e=>{let{field:t}=e;return(0,a.jsxs)(tz,{children:[(0,a.jsx)(tL,{className:"text-sm font-medium",children:"Full Name"}),(0,a.jsx)(tP,{children:(0,a.jsx)(O,{placeholder:"John Doe",className:"h-11",...t})}),(0,a.jsx)(tO,{})]})}}),(0,a.jsx)(tA,{control:m.control,name:"email",render:e=>{let{field:t}=e;return(0,a.jsxs)(tz,{children:[(0,a.jsx)(tL,{className:"text-sm font-medium",children:"Email"}),(0,a.jsx)(tP,{children:(0,a.jsx)(O,{placeholder:"name@example.com",type:"email",className:"h-11",...t})}),(0,a.jsx)(tO,{})]})}}),(0,a.jsx)(tA,{control:m.control,name:"password",render:e=>{let{field:t}=e;return(0,a.jsxs)(tz,{children:[(0,a.jsx)(tL,{className:"text-sm font-medium",children:"Password"}),(0,a.jsx)(tP,{children:(0,a.jsx)(O,{placeholder:"At least 6 characters",type:"password",className:"h-11",...t})}),(0,a.jsx)(tO,{})]})}}),(0,a.jsx)(P,{type:"submit",className:"w-full h-11 font-medium",disabled:s,children:s?"Creating Account...":"Create Account"})]})})})})]})]})}),(0,a.jsx)(E,{className:"flex justify-center px-6 py-4 text-center",children:(0,a.jsxs)("p",{className:"text-xs",children:["By continuing, you agree to our ",(0,a.jsx)("span",{className:"underline cursor-pointer",children:"Terms"})," & ",(0,a.jsx)("span",{className:"underline cursor-pointer",children:"Privacy Policy"})]})})]}),(0,a.jsxs)("p",{className:"text-xs mt-6",children:["\xa9 ",new Date().getFullYear()," MemChat. All rights reserved."]})]},d)}):null}function tq(){let[e,t]=(0,r.useState)(!1),[s,i]=(0,r.useState)(!0);return((0,r.useEffect)(()=>{let e=localStorage.getItem("auth_state");e&&t("true"===e);let s=(0,l.hg)(c,e=>{let s=!!e;t(s),localStorage.setItem("auth_state",s.toString()),i(!1)});return()=>s()},[]),s)?(0,a.jsx)("main",{className:"h-screen w-screen overflow-hidden bg-black flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-white text-xl",children:"Loading..."})}):(0,a.jsx)("main",{className:"h-screen w-screen overflow-hidden bg-black",children:e?(0,a.jsx)(tp,{}):(0,a.jsx)(tW,{})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[992,888,182,432,441,517,358],()=>t(6388)),_N_E=e.O()}]);